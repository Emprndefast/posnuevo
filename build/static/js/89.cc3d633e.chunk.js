"use strict";(self.webpackChunkpos_repair_pwa=self.webpackChunkpos_repair_pwa||[]).push([[89],{43089:(e,a,r)=>{r.r(a),r.d(a,{default:()=>y});var s=r(65043),t=r(53969),n=r(55895),o=r(91449),i=r(66154),l=r(85877),c=r(12097),d=r(80172),u=r(86213),p=r(55472),m=r(39166),h=r(95187),g=r(70579);const y=e=>{let{onClose:a}=e;const[r,y]=(0,s.useState)(""),[A,b]=(0,s.useState)(""),[f,j]=(0,s.useState)(!1),[v,x]=(0,s.useState)(null),{user:C,reloadUser:w}=(0,h.A)(),W=e=>/^\+[1-9]\d{10,14}$/.test(e);return(0,g.jsxs)(t.A,{sx:{p:3,minWidth:350},children:[(0,g.jsx)(n.A,{variant:"h6",sx:{mb:2},children:"Configuraci\xf3n de WhatsApp"}),(0,g.jsxs)(n.A,{variant:"body2",sx:{mb:2},children:["1. Guarda el n\xfamero ",(0,g.jsx)("b",{children:"+34 644 51 95 23"}),' en tus contactos como "CallMeBot".',(0,g.jsx)("br",{}),"2. Env\xeda el mensaje ",(0,g.jsx)("b",{children:'"I allow callmebot to send me messages"'})," a ese n\xfamero.",(0,g.jsx)("br",{}),"3. Recibir\xe1s tu API Key por WhatsApp.",(0,g.jsx)("br",{}),"4. Ingresa tu n\xfamero y API Key aqu\xed."]}),v&&(0,g.jsx)(o.A,{severity:v.type,sx:{mb:2},children:v.message}),(0,g.jsx)(i.A,{fullWidth:!0,label:"N\xfamero de WhatsApp",value:r,onChange:e=>y(e.target.value),placeholder:"+18091234567",margin:"normal"}),(0,g.jsx)(i.A,{fullWidth:!0,label:"API Key de CallMeBot",value:A,onChange:e=>b(e.target.value),margin:"normal",type:"password"}),(0,g.jsxs)(l.A,{children:[(0,g.jsx)(c.A,{onClick:a,children:"Cerrar"}),(0,g.jsx)(c.A,{variant:"outlined",onClick:async()=>{if(x(null),W(r))if(A.trim())try{const e=(0,p.H9)(m.db,"users",C.uid);await(0,p.mZ)(e,{whatsapp:{number:r,apiKey:A}}),console.log("Configuraci\xf3n de WhatsApp guardada en Firestore"),"function"===typeof w&&(await w(),console.log("Usuario tras reloadUser:",C)),setTimeout((()=>{window.location.reload()}),500),x({type:"success",message:"Configuraci\xf3n guardada correctamente"})}catch(e){console.error("Error al guardar configuraci\xf3n de WhatsApp:",e),x({type:"error",message:"Error al guardar configuraci\xf3n"})}else x({type:"error",message:"API Key es requerida"});else x({type:"error",message:"N\xfamero de WhatsApp inv\xe1lido (usa formato internacional)"})},disabled:f,children:"Guardar"}),(0,g.jsx)(c.A,{variant:"contained",onClick:async()=>{if(x(null),W(r))if(A.trim()){j(!0);try{const e=await u.A.post("http://localhost:3001/api/notifications/test-whatsapp",{phone:r,message:"\ud83d\udd14 Prueba de notificaci\xf3n POS-NT",apiKey:A});e.data.success?x({type:"success",message:"Mensaje de prueba enviado correctamente"}):x({type:"error",message:e.data.error})}catch(s){var e,a;x({type:"error",message:(null===(e=s.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.error)||"Error al enviar mensaje"})}finally{j(!1)}}else x({type:"error",message:"API Key es requerida"});else x({type:"error",message:"N\xfamero de WhatsApp inv\xe1lido (usa formato internacional)"})},disabled:f,children:f?(0,g.jsx)(d.A,{size:20}):"Enviar Mensaje de Prueba"})]})]})}}}]);
//# sourceMappingURL=89.cc3d633e.chunk.js.map