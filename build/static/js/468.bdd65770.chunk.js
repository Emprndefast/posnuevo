"use strict";(self.webpackChunkpos_repair_pwa=self.webpackChunkpos_repair_pwa||[]).push([[468],{8468:(e,a,s)=>{s.r(a),s.d(a,{default:()=>M});var i=s(65043),r=s(53969),n=s(55895),o=s(14333),t=s(12843),d=s(70298),l=s(1725),c=s(85030),u=s(10256),h=s(79067),p=s(67203),x=s(47471),b=s(12097),g=s(66154),j=s(80172),v=s(91449),A=s(70916),m=s(51697),y=s(14057),C=s(70579);const k=(0,y.A)((0,C.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload");var f=s(55472),w=s(39166),z=s(95187),S=s(8966),B=s(18390),G=s(37618),_=s(99435);const M=e=>{let{onClose:a}=e;const[s,y]=(0,i.useState)({autoBackup:!1,backupFrequency:"daily",cloudUser:"",cloudToken:"",interval:5,batchSize:1e3,loading:!1,status:"",error:""}),[M,N]=(0,i.useState)(0),[W,D]=(0,i.useState)({open:!1,message:"",severity:"success"}),{user:F}=(0,z.A)(),{productos:H,setProductos:P}=(0,S.h)(),{clientes:U,setClientes:E}=(0,B.n)(),{ventas:J,setVentas:T}=(0,G.L)(),{config:q,setConfig:I}=(0,_.U)(),R=e=>a=>{y({...s,[e]:"checkbox"===a.target.type?a.target.checked:a.target.value})};return(0,C.jsxs)(r.A,{sx:{p:3,minWidth:400},children:[(0,C.jsx)(n.A,{variant:"h6",sx:{mb:2},children:"Configuraci\xf3n de Respaldos y Nube"}),(0,C.jsxs)(o.A,{value:M,onChange:(e,a)=>N(a),sx:{mb:2},children:[(0,C.jsx)(t.A,{label:"Respaldos locales"}),(0,C.jsx)(t.A,{label:"Nube / Sincronizaci\xf3n"})]}),0===M&&(0,C.jsxs)(d.A,{spacing:2,children:[(0,C.jsx)(l.A,{control:(0,C.jsx)(c.A,{checked:s.autoBackup,onChange:R("autoBackup")}),label:"Respaldo autom\xe1tico"}),(0,C.jsxs)(u.A,{fullWidth:!0,size:"small",disabled:!s.autoBackup,children:[(0,C.jsx)(h.A,{children:"Frecuencia de respaldo"}),(0,C.jsxs)(p.A,{value:s.backupFrequency,onChange:R("backupFrequency"),label:"Frecuencia de respaldo",children:[(0,C.jsx)(x.A,{value:"daily",children:"Diario"}),(0,C.jsx)(x.A,{value:"weekly",children:"Semanal"}),(0,C.jsx)(x.A,{value:"monthly",children:"Mensual"})]})]}),(0,C.jsxs)(d.A,{direction:"row",spacing:2,sx:{mt:2},children:[(0,C.jsx)(b.A,{variant:"contained",onClick:a,children:"Guardar"}),(0,C.jsx)(b.A,{variant:"outlined",onClick:a,children:"Cerrar"})]})]}),1===M&&(0,C.jsxs)(d.A,{spacing:2,children:[(0,C.jsx)(n.A,{variant:"subtitle1",children:"Configuraci\xf3n de Nube"}),(0,C.jsx)(g.A,{label:"Usuario de nube",value:s.cloudUser,onChange:R("cloudUser"),fullWidth:!0,size:"small"}),(0,C.jsx)(g.A,{label:"Token/Contrase\xf1a",value:s.cloudToken,onChange:R("cloudToken"),fullWidth:!0,size:"small",type:"password"}),(0,C.jsx)(g.A,{label:"Intervalo de sincronizaci\xf3n (min)",type:"number",value:s.interval,onChange:R("interval"),fullWidth:!0,size:"small"}),(0,C.jsx)(g.A,{label:"Cantidad de registros por petici\xf3n",type:"number",value:s.batchSize,onChange:R("batchSize"),fullWidth:!0,size:"small"}),(0,C.jsx)(n.A,{variant:"subtitle2",sx:{mt:2},children:"Sincronizaci\xf3n manual"}),(0,C.jsxs)(d.A,{direction:"row",spacing:2,children:[(0,C.jsx)(b.A,{variant:"contained",color:"primary",startIcon:(0,C.jsx)(m.A,{}),disabled:s.loading,onClick:async()=>{if(F){y((e=>({...e,loading:!0,status:"",error:""})));try{for(const e of H)await(0,f.BN)((0,f.H9)(w.db,"productos",e.id),{...e,uid:F.uid});for(const e of U)await(0,f.BN)((0,f.H9)(w.db,"clientes",e.id),{...e,uid:F.uid});for(const e of J)await(0,f.BN)((0,f.H9)(w.db,"ventas",e.id),{...e,uid:F.uid});await(0,f.BN)((0,f.H9)(w.db,"configuracion",F.uid),{...q,uid:F.uid}),y((e=>({...e,loading:!1,status:"Sincronizaci\xf3n subida exitosa"}))),D({open:!0,message:"Datos subidos exitosamente a la nube",severity:"success"})}catch(e){y((e=>({...e,loading:!1,error:"Error al subir datos"}))),D({open:!0,message:"Error al subir datos",severity:"error"})}}},children:"Subir todo"}),(0,C.jsx)(b.A,{variant:"outlined",color:"primary",startIcon:(0,C.jsx)(k,{}),disabled:s.loading,onClick:async()=>{if(F){y((e=>({...e,loading:!0,status:"",error:""})));try{const e=(0,f.P)((0,f.rJ)(w.db,"productos"),(0,f._M)("uid","==",F.uid)),a=await(0,f.GG)(e);P(a.docs.map((e=>({id:e.id,...e.data()}))));const s=(0,f.P)((0,f.rJ)(w.db,"clientes"),(0,f._M)("uid","==",F.uid)),i=await(0,f.GG)(s);E(i.docs.map((e=>({id:e.id,...e.data()}))));const r=(0,f.P)((0,f.rJ)(w.db,"ventas"),(0,f._M)("uid","==",F.uid)),n=await(0,f.GG)(r);T(n.docs.map((e=>({id:e.id,...e.data()}))));const o=await(0,f.GG)((0,f.P)((0,f.rJ)(w.db,"configuracion"),(0,f._M)("uid","==",F.uid)));o.empty||I({...o.docs[0].data()}),y((e=>({...e,loading:!1,status:"Sincronizaci\xf3n descarga exitosa"}))),D({open:!0,message:"Datos descargados exitosamente de la nube",severity:"success"})}catch(e){y((e=>({...e,loading:!1,error:"Error al descargar datos"}))),D({open:!0,message:"Error al descargar datos",severity:"error"})}}},children:"Bajar todo"}),s.loading&&(0,C.jsx)(j.A,{size:28,sx:{ml:2}})]}),s.status&&(0,C.jsx)(v.A,{severity:"success",children:s.status}),s.error&&(0,C.jsx)(v.A,{severity:"error",children:s.error})]}),(0,C.jsx)(A.A,{open:W.open,autoHideDuration:3e3,onClose:()=>D({...W,open:!1}),children:(0,C.jsx)(v.A,{severity:W.severity,children:W.message})})]})}}}]);
//# sourceMappingURL=468.bdd65770.chunk.js.map